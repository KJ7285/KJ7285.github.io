<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Comfortable Dark Theme Notepad</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #1e1e1e;
      color: #ddd;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background-color: #2b2b2b;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      border-bottom: 1px solid #444;
      color: #f0f0f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #editor {
      flex-grow: 1;
      padding: 1.5rem;
      font-size: 1.1rem;
      line-height: 1.7;
      background-color: #2a2a2a;
      color: #e0e0e0;
      border: none;
      outline: none;
      width: 100%;
      overflow-y: auto;
      min-height: 300px;
    }

    #editor:empty:before {
      content: attr(placeholder);
      color: #777;
      pointer-events: none;
      display: block;
    }

    #editor:focus {
      outline: none;
    }

    footer {
      background-color: #2b2b2b;
      padding: 0.8rem 1rem;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      border-top: 1px solid #444;
      gap: 10px;
    }

    button {
      background-color: #3a3a3a;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
    }

    button:hover {
      background-color: #4a4a4a;
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
    }

    button img {
      height: 20px;
      width: 20px;
      filter: brightness(0) invert(1);
    }

    #editor img {
      max-width: 100%;
      max-height: 300px;
      border-radius: 8px;
      margin: 10px 0;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      cursor: pointer;
      transition: transform 0.2s;
    }

    #editor img:hover {
      transform: scale(1.02);
    }

    .image-container {
      position: relative;
      display: inline-block;
    }

    .delete-image-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: rgba(255, 0, 0, 0.7);
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 12px;
      cursor: pointer;
      display: none;
    }

    .image-container:hover .delete-image-btn {
      display: block;
    }

    .status-bar {
      background-color: #252525;
      padding: 0.3rem 1rem;
      font-size: 0.8rem;
      color: #aaa;
      display: flex;
      justify-content: space-between;
    }

    .word-count {
      margin-left: auto;
    }

    .toggle-dark {
      background: none;
      border: none;
      color: #ddd;
      cursor: pointer;
      font-size: 1.2rem;
    }

    @media (max-width: 600px) {
      header {
        font-size: 1.2rem;
        flex-direction: column;
        gap: 10px;
      }

      footer {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
      }

      button {
        width: auto;
      }
    }

    /* Animation for new images */
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
  </style>
</head>
<body>
  <header>
    <span>Comfortable Dark Notepad</span>
    <button class="toggle-dark" title="Toggle theme">ðŸŒ“</button>
  </header>

  <div class="status-bar">
    <span class="word-count">0 words</span>
  </div>

  <div id="editor" contenteditable="true" placeholder="Start typing..."></div>

  <footer>
    <input type="file" id="imageInput" accept="image/*" style="display:none" />
    <button id="insertImageBtn">
      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0ibHVjaWRlIGx1Y2lkZS1pbWFnZS1wbHVzIj48cGF0aCBkPSJNMjEgMTJ2M2EyIDIgMCAwIDEtMiAySDVhMiAyIDAgMCAxLTItMnYtMyIvPjxwYXRoIGQ9Ik0xNiA1aDNhMiAyIDAgMCAxIDIgMnYzIi8+PHBhdGggZD0iTTMgMTZoNSIvPjxwYXRoIGQ9Im04IDE1IDQtNGEyIDIgMCAwIDEgMyAwbDQgNCIvPjxwYXRoIGQ9Ik0xNCA4aC4wMSIvPjwvc3ZnPg==" alt="Insert" />
      Insert Image
    </button>
    <button onclick="saveFile()">
      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0ibHVjaWRlIGx1Y2lkZS1zYXZlIj48cGF0aCBkPSJNMTkgMjFINWEyIDIgMCAwIDEtMi0yVjVhMiAyIDAgMCAxIDItMmgxMWw0IDR2M2EyIDIgMCAwIDAgMiAyaDN6Ii8+PHBhdGggZD0iTTE3IDIxdi04SDd2OCIvPjxwYXRoIGQ9Ik03IDN2NWg4Ii8+PC9zdmc+" alt="Save" />
      Save as TXT
    </button>
  </footer>

  <audio id="typeSound" src="https://assets.mixkit.co/sfx/preview/mixkit-typewriter-soft-click-1125.mp3" preload="auto"></audio>

  <script>
    const editor = document.getElementById('editor');
    const typeSound = document.getElementById('typeSound');
    const wordCountElement = document.querySelector('.word-count');
    const insertImageBtn = document.getElementById('insertImageBtn');
    const imageInput = document.getElementById('imageInput');
    const toggleDarkBtn = document.querySelector('.toggle-dark');

    // Typing sound
    editor.addEventListener('input', () => {
      updateWordCount();
      
      // Play sound only if there's actual content change (not just cursor movement)
      if (window.getSelection().toString().length === 0) {
        const clone = typeSound.cloneNode();
        clone.volume = 0.3;
        clone.play().catch(e => console.log("Audio play failed:", e));
      }
    });

    // Update word count
    function updateWordCount() {
      const text = editor.innerText.trim();
      const wordCount = text === '' ? 0 : text.split(/\s+/).length;
      wordCountElement.textContent = `${wordCount} word${wordCount !== 1 ? 's' : ''}`;
    }

    // Insert image with better handling
    insertImageBtn.addEventListener('click', () => imageInput.click());
    
    imageInput.addEventListener('change', function() {
      const file = this.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const container = document.createElement('div');
          container.className = 'image-container fade-in';
          
          const img = document.createElement('img');
          img.src = e.target.result;
          
          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'delete-image-btn';
          deleteBtn.innerHTML = 'Ã—';
          deleteBtn.title = 'Delete image';
          deleteBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            container.remove();
          });
          
          container.appendChild(img);
          container.appendChild(deleteBtn);
          
          // Insert at cursor position
          const selection = window.getSelection();
          if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            range.deleteContents();
            range.insertNode(container);
            
            // Add paragraph after image if needed
            if (!range.startContainer.nextSibling || 
                range.startContainer.nextSibling.nodeName !== 'P') {
              const p = document.createElement('p');
              p.innerHTML = '<br>';
              container.after(p);
            }
            
            // Move cursor after the image
            const newRange = document.createRange();
            newRange.setStartAfter(container);
            newRange.collapse(true);
            selection.removeAllRanges();
            selection.addRange(newRange);
          }
          
          // Scroll to show the new image
          container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        };
        reader.readAsDataURL(file);
        this.value = ''; // reset input
      }
    });

    // Save to TXT (now includes basic formatting)
    function saveFile() {
      let text = editor.innerText;
      
      // Create a more readable version with line breaks
      const div = document.createElement('div');
      div.innerHTML = editor.innerHTML;
      
      // Convert images to text indicators
      const images = div.querySelectorAll('img');
      images.forEach((img, index) => {
        const replacement = document.createTextNode(`\n[Image ${index + 1}]\n`);
        img.parentNode.replaceChild(replacement, img);
      });
      
      // Convert divs to line breaks
      text = div.innerText.replace(/\n{3,}/g, '\n\n');
      
      const blob = new Blob([text], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `notes-${new Date().toISOString().slice(0,10)}.txt`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      // Show a quick visual feedback
      const originalText = link.textContent;
      link.textContent = 'Saved!';
      link.style.backgroundColor = '#4CAF50';
      setTimeout(() => {
        link.textContent = originalText;
        link.style.backgroundColor = '';
      }, 1000);
    }

    // Toggle dark/light theme
    toggleDarkBtn.addEventListener('click', () => {
      document.body.classList.toggle('light-theme');
      if (document.body.classList.contains('light-theme')) {
        toggleDarkBtn.textContent = 'ðŸŒ’';
        document.body.style.backgroundColor = '#f5f5f5';
        document.body.style.color = '#333';
        editor.style.backgroundColor = '#fff';
        editor.style.color = '#333';
        header.style.backgroundColor = '#e0e0e0';
        header.style.color = '#333';
        footer.style.backgroundColor = '#e0e0e0';
        document.querySelectorAll('button').forEach(btn => {
          if (btn !== toggleDarkBtn) {
            btn.style.backgroundColor = '#4a4a4a';
            btn.style.color = 'white';
          }
        });
      } else {
        toggleDarkBtn.textContent = 'ðŸŒ“';
        document.body.style.backgroundColor = '#1e1e1e';
        document.body.style.color = '#ddd';
        editor.style.backgroundColor = '#2a2a2a';
        editor.style.color = '#e0e0e0';
        header.style.backgroundColor = '#2b2b2b';
        header.style.color = '#f0f0f0';
        footer.style.backgroundColor = '#2b2b2b';
        document.querySelectorAll('button').forEach(btn => {
          if (btn !== toggleDarkBtn) {
            btn.style.backgroundColor = '#3a3a3a';
            btn.style.color = 'white';
          }
        });
      }
    });

    // Initialize word count
    updateWordCount();
  </script>
</body>
</html>
